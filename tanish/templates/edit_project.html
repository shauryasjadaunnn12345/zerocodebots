{% extends "home.html" %}
{% load static %}

{% block title %}Edit Project ‚Äì {{ project.title }} | ZeroCodeBots{% endblock title %}

{% block breadcrumbs %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://zerocodebots.com/"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "My Projects",
      "item": "https://zerocodebots.com/my-projects/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ project.title|escapejs }}",
      "item": "https://zerocodebots.com/project/{{ project.id }}/edit/"
    }
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Edit Project",
  "description": "Edit and train your chatbot by adding question and answer prompts, images, and embedding your bot anywhere.",
  "url": "https://zerocodebots.com/project/{{ project.id }}/edit/"
}
</script>
{% endblock breadcrumbs %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/edit-project.css' %}">
{% endblock style %}

{% block body %}
<section class="edit-project-page">

  <h2>Create questions users may ask and provide answers</h2>

  <form method="post" enctype="multipart/form-data" class="edit-project-form">
    {% csrf_token %}
    {{ formset.management_form }}

    <!-- Import Section -->
    <div class="qa-block import-block">
      <h3>Import Q/A from your website</h3>

      <label>Website URL</label>
      <input type="text" id="website-url" placeholder="https://example.com/faq">

      <div class="import-actions">
        <label class="checkbox">
          <input type="checkbox" id="use-ai-checkbox">
          Use AI to generate Q/A
        </label>

        <button type="button" id="import-site-btn" class="primary-btn" data-url="{% url 'import_from_website' project.id %}">
          Import from Website
        </button>

        <span id="import-result"></span>
      </div>
    </div>

    <!-- QA Blocks -->
    {% for form in formset %}
    <div class="qa-block">
      <h3>Question {{ forloop.counter }}</h3>

      {{ form.id }}

      <label>Question</label>
      {{ form.question }}

      <label>Answer</label>
      {{ form.answer }}

      <label>Upload image (optional)</label>
      {{ form.image }}

      {% if form.instance.image %}
        <img src="{{ form.instance.image.url }}" alt="Uploaded image">
      {% endif %}

      <label>Image description (optional)</label>
      {{ form.image_description }}

      <label class="delete">
        {{ form.DELETE }} Delete this Q/A
      </label>
    </div>
    {% endfor %}

    <button type="submit" class="primary-btn save-btn">
      Save Changes
    </button>
  </form>

  <!-- Test Bot -->
  <a href="{% url 'chatbot' project.id %}" target="_blank" class="test-bot-btn">
    Test Your Bot Progress
  </a>

  <!-- Bot Key -->
  <div class="bot-key-section">
  
    <h4>Paste this code in your website to activate chatbot</h4>
    <div class="embed-box">
      <button id="copyBtn" class="copy-btn">üìã Copy</button>
      <code id="embedCode">
&lt;script&gt;
(function () {
  const botKey = "{{ project.bot_key }}";
  const iframeUrl = "https://zerocodebots.onrender.com/embed-chatbot/?key=" + botKey;
  const iframe = document.createElement("iframe");
  iframe.src = iframeUrl;
  iframe.style.cssText =
    "position:fixed;bottom:20px;right:20px;width:350px;height:500px;border:none;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,.2);z-index:9999;display:none";

  const btn = document.createElement("button");
  btn.innerText = "üí¨";
  btn.style.cssText =
    "position:fixed;bottom:20px;right:20px;width:60px;height:60px;border:none;border-radius:50%;background:#4a90e2;color:#fff;font-size:24px;cursor:pointer;z-index:10000";

  btn.onclick = () => iframe.style.display =
    iframe.style.display === "none" ? "block" : "none";

  document.body.append(btn, iframe);
})();
&lt;/script&gt;
      </code>
    </div>
  </div>

  <a href="{% url 'my_projects' %}" class="back-link">
    ‚Üê Back to My Projects
  </a>

</section>

<script src="{% static 'js/edit-project.js' %}" defer></script>
{% endblock body %}

